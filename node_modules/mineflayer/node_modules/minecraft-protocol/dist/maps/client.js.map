{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client.js","sourcesContent":["'use strict';\n\nconst EventEmitter = require('events').EventEmitter;\nconst debug = require('debug')('minecraft-protocol');\nconst compression = require('./transforms/compression');\nconst framing = require('./transforms/framing');\nconst crypto = require('crypto');\nconst states = require(\"./states\");\n\nconst createSerializer=require(\"./transforms/serializer\").createSerializer;\nconst createDeserializer=require(\"./transforms/serializer\").createDeserializer;\n\nclass Client extends EventEmitter\n{\n  constructor(isServer,version,customPackets) {\n    super();\n    this.customPackets=customPackets;\n    this.version=version;\n    this.isServer = !!isServer;\n    this.splitter=framing.createSplitter();\n    this.setSerializer(states.HANDSHAKING);\n    this.packetsToParse={};\n    this.serializer;\n    this.compressor=null;\n    this.framer=framing.createFramer();\n    this.cipher=null;\n    this.decipher=null;\n    this.decompressor=null;\n    this.deserializer;\n    this.isServer;\n    this.protocolState=states.HANDSHAKING;\n    this.ended=true;\n    this.latency=0;\n\n    this.on('newListener', function(event, listener) {\n      const direction = this.isServer ? 'toServer' : 'toClient';\n      if(typeof this.packetsToParse[event] === \"undefined\") this.packetsToParse[event] = 1;\n      else this.packetsToParse[event] += 1;\n    });\n    this.on('removeListener', function(event, listener) {\n      const direction = this.isServer ? 'toServer' : 'toClient';\n      this.packetsToParse[event] -= 1;\n    });\n  }\n\n  get state(){\n    return this.protocolState;\n  }\n\n\n  setSerializer(state) {\n    this.serializer = createSerializer({ isServer:this.isServer, version:this.version, state: state,customPackets:this.customPackets});\n    this.deserializer = createDeserializer({ isServer:this.isServer, version:this.version, state: state, packetsToParse:\n      this.packetsToParse,customPackets:this.customPackets});\n\n    this.splitter.recognizeLegacyPing = state === states.HANDSHAKING;\n\n    this.serializer.on('error', (e) => {\n      let parts;\n      if(e.field) {\n        parts = e.field.split(\".\");\n        parts.shift();\n      }\n      else\n        parts=[];\n      const serializerDirection = !this.isServer ? 'toServer' : 'toClient';\n      e.field = [this.protocolState, serializerDirection].concat(parts).join(\".\");\n      e.message = `Serialization error for ${e.field} : ${e.message}`;\n      if(!this.compressor)\n        this.serializer.pipe(this.framer);\n      else\n        this.serializer.pipe(this.compressor);\n      this.emit('error',e);\n    });\n\n\n    this.deserializer.on('error', (e) => {\n      let parts;\n      if(e.field) {\n        parts = e.field.split(\".\");\n        parts.shift();\n      }\n      else\n        parts=[];\n      const deserializerDirection = this.isServer ? 'toServer' : 'toClient';\n      e.field = [this.protocolState, deserializerDirection].concat(parts).join(\".\");\n      e.message = `Deserialization error for ${e.field} : ${e.message}`;\n      if(!this.compressor)\n        this.splitter.pipe(this.deserializer);\n      else\n        this.decompressor.pipe(this.deserializer);\n      this.emit('error',e);\n    });\n\n    this.deserializer.on('data', (parsed) => {\n      parsed.metadata.name=parsed.data.name;\n      parsed.data=parsed.data.params;\n      parsed.metadata.state=state;\n      debug(\"read packet \" + state + \".\" + parsed.metadata.name);\n      debug(parsed.data);\n      this.emit('packet', parsed.data, parsed.metadata);\n      this.emit(parsed.metadata.name, parsed.data, parsed.metadata);\n      this.emit('raw.' + parsed.metadata.name, parsed.buffer, parsed.metadata);\n      this.emit('raw', parsed.buffer, parsed.metadata);\n    });\n  }\n\n  set state(newProperty) {\n    const oldProperty = this.protocolState;\n    this.protocolState = newProperty;\n\n    if(!this.compressor)\n    {\n      this.serializer.unpipe(this.framer);\n      this.splitter.unpipe(this.deserializer);\n    }\n    else\n    {\n      this.serializer.unpipe(this.compressor);\n      this.decompressor.unpipe(this.deserializer);\n    }\n\n    this.serializer.removeAllListeners();\n    this.deserializer.removeAllListeners();\n    this.setSerializer(this.protocolState);\n\n    if(!this.compressor)\n    {\n      this.serializer.pipe(this.framer);\n      this.splitter.pipe(this.deserializer);\n    }\n    else\n    {\n      this.serializer.pipe(this.compressor);\n      this.decompressor.pipe(this.deserializer);\n    }\n\n    this.emit('state', newProperty, oldProperty);\n  }\n\n  get compressionThreshold() {\n    return this.compressor == null ? -2 : this.compressor.compressionThreshold;\n  }\n\n  set compressionThreshold(threshold) {\n    this.setCompressionThreshold(threshold);\n  }\n\n  setSocket(socket) {\n    this.ended = false;\n\n    // TODO : A lot of other things needs to be done.\n    const endSocket = () => {\n      if(this.ended) return;\n      this.ended = true;\n      this.socket.removeListener('close', endSocket);\n      this.socket.removeListener('end', endSocket);\n      this.socket.removeListener('timeout', endSocket);\n      this.emit('end', this._endReason);\n    };\n\n    const onFatalError = (err) => {\n      this.emit('error', err);\n      endSocket();\n    };\n\n    const onError = (err) => this.emit('error', err);\n\n    this.socket = socket;\n\n    if(this.socket.setNoDelay)\n      this.socket.setNoDelay(true);\n\n    this.socket.on('connect', () => this.emit('connect'));\n\n    this.socket.on('error', onFatalError);\n    this.socket.on('close', endSocket);\n    this.socket.on('end', endSocket);\n    this.socket.on('timeout', endSocket);\n    this.framer.on('error', onError);\n    this.splitter.on('error', onError);\n\n    this.socket.pipe(this.splitter).pipe(this.deserializer);\n    this.serializer.pipe(this.framer).pipe(this.socket);\n  }\n\n  end(reason) {\n    this._endReason = reason;\n    if(this.cipher) this.cipher.unpipe();\n    if(this.framer) this.framer.unpipe();\n    if(this.socket) this.socket.end();\n  }\n\n  setEncryption(sharedSecret) {\n    if (this.cipher != null)\n      throw new Error(\"Set encryption twice !\");\n    this.cipher = crypto.createCipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n    this.cipher.on('error', (err) => this.emit('error', err));\n    this.framer.unpipe(this.socket);\n    this.framer.pipe(this.cipher).pipe(this.socket);\n    this.decipher = crypto.createDecipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n    this.decipher.on('error', (err) => this.emit('error', err));\n    this.socket.unpipe(this.splitter);\n    this.socket.pipe(this.decipher).pipe(this.splitter);\n  }\n\n  setCompressionThreshold(threshold) {\n    if (this.compressor == null) {\n      this.compressor = compression.createCompressor(threshold);\n      this.compressor.on('error', (err) => this.emit('error', err));\n      this.serializer.unpipe(this.framer);\n      this.serializer.pipe(this.compressor).pipe(this.framer);\n      this.decompressor = compression.createDecompressor(threshold);\n      this.decompressor.on('error', (err) => this.emit('error', err));\n      this.splitter.unpipe(this.deserializer);\n      this.splitter.pipe(this.decompressor).pipe(this.deserializer);\n    } else {\n      this.decompressor.threshold = threshold;\n      this.compressor.threshold = threshold;\n    }\n  }\n\n  write(name, params) {\n    if(this.ended)\n      return;\n    debug(\"writing packet \" + this.state + \".\" + name);\n    debug(params);\n    this.serializer.write({ name, params });\n  }\n\n  writeRaw(buffer) {\n    if(this.ended)\n      return;\n    if (this.compressor === null)\n      this.framer.write(buffer);\n    else\n      this.compressor.write(buffer);\n  }\n\n  // TCP/IP-specific (not generic Stream) method for backwards-compatibility\n  connect(port, host) {\n    const options = {port, host};\n    if (!this.options) this.options = options;\n    require('./client/tcp_dns')(this, options);\n    options.connect(this);\n  }\n}\n\nmodule.exports = Client;\n"],"sourceRoot":"/source/"}