{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils.js","sourcesContent":["\nfunction getField(countField, context) {\n  var countFieldArr = countField.split(\"/\");\n  var i = 0;\n  if (countFieldArr[i] === \"\") {\n    while (context.hasOwnProperty(\"..\"))\n      context = context[\"..\"];\n    i++;\n  }\n  for(; i < countFieldArr.length; i++)\n    context = context[countFieldArr[i]];\n  return context;\n}\n\nfunction getFieldInfo(fieldInfo) {\n  if (typeof fieldInfo === \"string\")\n    return { type: fieldInfo };\n  else if (Array.isArray(fieldInfo))\n    return { type: fieldInfo[0], typeArgs: fieldInfo[1] };\n  else if (typeof fieldInfo.type === \"string\")\n    return fieldInfo;\n  else\n    throw new Error(\"Not a fieldinfo\");\n}\n\nfunction getCount(buffer, offset, { count, countType, countTypeArgs }, rootNode) {\n  var c = 0;\n  var size = 0;\n  if(typeof count === \"number\")\n    c = count;\n  else if (typeof count !== \"undefined\") {\n    c = getField(count, rootNode);\n  } else if (typeof countType !== \"undefined\") {\n    ({size,value: c}=tryDoc(() => this.read(buffer, offset, { type: countType, typeArgs: countTypeArgs }, rootNode),\"$count\"));\n  } else // TODO : broken schema, should probably error out.\n    c = 0;\n  return { count: c, size };\n}\n\nfunction sendCount(len, buffer, offset, { count, countType, countTypeArgs }, rootNode) {\n  if (typeof count !== \"undefined\" && len !== count) {\n    // TODO: Throw\n  } else if (typeof countType !== \"undefined\") {\n    offset = this.write(len, buffer, offset, { type: countType, typeArgs: countTypeArgs }, rootNode);\n  } else {\n    // TODO: Throw\n  }\n  return offset;\n}\n\nfunction calcCount(len, { count, countType, countTypeArgs }, rootNode) {\n  if (typeof count === \"undefined\" && typeof countType !== \"undefined\")\n    return tryDoc(() => this.sizeOf(len, { type: countType, typeArgs: countTypeArgs }, rootNode),\"$count\");\n  else\n    return 0;\n}\n\nfunction addErrorField(e, field) {\n  e.field = e.field ? field + \".\" + e.field : field;\n  throw e;\n}\n\nfunction tryCatch(tryfn, catchfn) {\n  try { return tryfn(); } catch (e) { catchfn(e); }\n}\n\nfunction tryDoc(tryfn,field) {\n  return tryCatch(tryfn,(e) => addErrorField(e,field));\n}\n\nclass ExtendableError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = this.constructor.name;\n    this.message = message;\n    Error.captureStackTrace(this, this.constructor.name)\n  }\n}\n\nclass PartialReadError extends ExtendableError {\n  constructor(message) {\n    super(message);\n    this.partialReadError=true;\n  }\n}\n\nmodule.exports = {\n  getField: getField,\n  getFieldInfo: getFieldInfo,\n  addErrorField: addErrorField,\n  getCount: getCount,\n  sendCount: sendCount,\n  calcCount: calcCount,\n  tryCatch: tryCatch,\n  tryDoc: tryDoc,\n  PartialReadError:PartialReadError\n};\n"],"sourceRoot":"/source/"}